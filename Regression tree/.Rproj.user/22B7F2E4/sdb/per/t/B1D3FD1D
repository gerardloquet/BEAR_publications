{
    "collab_server" : "",
    "contents" : "\n\n#Tobias Piechowiak\n\nlibrary('ggplot2')\nlibrary('partykit')\nlibrary('rpart.plot')\nlibrary('rpart')\nlibrary('dplyr')\n\npath <- '../../Data/data/'\n\ndata_time <- read.csv(paste0(path,'Tid_mellem_udlevering_og_andet_besoeg.csv'))\ndata_SSQ_1 <- read.csv(paste0(path,'SSQ_1.csv'))\ndata_SSQ_2 <- read.csv(paste0(path,'SSQ_2.csv'))\ndata_SSQ_age_gender <- read.csv(paste0(path,'SSQ_age_gender.csv'))\ndata_experience <- read.csv(paste0(path,'HA_experience.csv'))\n\naudiogram <- read.csv2(paste0(path,'audiogramdata.csv'))\n\n\n\n#processing date \ndata_time$Time_diff_visits <- as.numeric(as.Date(data_time[,4]) - as.Date(data_time[,3]))\n\n\n#processing SSQ\ndata_SSQ <- merge(data_SSQ_1,data_SSQ_2,by = c('record_id'))\ndata_SSQ <- merge(data_SSQ,data_SSQ_age_gender,by = c('record_id'))\ndata_SSQ <- data_SSQ[,-c(2,40)]\n\n\n\n#merge time and SSQ \ndata_1 <- merge(data_SSQ,data_time,by = c('record_id'))\n\n\n#mean across SSQs\ndata_1 <- transform(data_1,SSQ1 = rowMeans(data_1[,seq(2,18,1)],na.rm = TRUE))\ndata_1 <- transform(data_1,SSQ2 = rowMeans(data_1[,seq(21,37,1)],na.rm = TRUE))\n\ndata_1$diff_SSQ <- data_1$SSQ2 - data_1$SSQ1\n\ndata_1$sex <- as.factor(data_1$sex)\ndata_1$rand_apparat <- as.factor(data_1$rand_apparat)\ndata_1$own_ha <- as.factor(data_1$own_ha)\ndata_1$ha_dispencer <- as.factor(data_1$ha_dispencer)\n\n\ndata_1 <- merge(data_1,data_experience,by = c('record_id'))\n\nnames(data_1)[names(data_1) == 'age.x'] <- 'age'\nnames(data_1)[names(data_1) == 'sex.x'] <- 'sex'\n\n#plot some shit \nggplot(data_1, aes(diff_SSQ)) + \n  geom_histogram(data = subset(data_1,rand_apparat == 1), fill = 'red', alpha = 0.7, binwidth = 4,na.rm = TRUE) +\n  geom_histogram(data = subset(data_1,rand_apparat == 2), fill = 'green', alpha = 0.7, binwidth = 4,na.rm = TRUE) +\n  geom_histogram(data = subset(data_1,rand_apparat == 3), fill = 'blue', alpha = 0.7, binwidth = 4,na.rm = TRUE) +\n  facet_grid(~ rand_apparat) +\n  geom_vline(xintercept=c(0), color = 'black') \n\n\nggplot(data_1, aes(x=Time_diff_visits, y=diff_SSQ)) + \n  geom_point() + stat_smooth(method=lm)\n\n\nggplot(data_1, aes(diff_SSQ)) + \n  geom_histogram(data = subset(data_1,sex.x == 1),fill='blue',alpha = 0.7, binwidth = 4,na.rm = TRUE) + \n  geom_histogram(data = subset(data_1,sex.x == 2),fill = 'red', alpha = 0.7, binwidth = 4,na.rm = TRUE) +\n  geom_vline(xintercept = c(0), color='black') +\n  facet_grid(~sex)\n\n\nggplot(data_1, aes(x=age.x, y=diff_SSQ)) + \n  geom_point() + \n  stat_smooth(method=lm)\n\n\n#audiogram data \n\naudiogram.left <- read.csv(paste0(path,'Audiogram_left_classified.csv'))\naudiogram.right <- read.csv(paste0(path,'Audiogram_right_classified.csv'))\n\ncolnames(audiogram.right)[c(2)] <- c('Age')\ncolnames(audiogram.left)[c(2)] <- c('Age')\n\n\ncolnames(data_1)[c(1)] = c('ID')\n\n\n#merge audiogram data with the remaining data \naudiogram.left$ear = c('left')\naudiogram.right$ear = c('right')\n\naudiogram <- rbind(audiogram.left,audiogram.right)\n\ndata_2 <- merge(data_1,audiogram,by=c('ID'))\n\ndrops <- c('redcap_event_name.y','redcap_event_name.x','age','age.y','sex.y','sex') \ndata_3 <- data_2[,!(names(data_2) %in% drops)]\n\n\n\n#tree model \nfit_tree <- rpart(diff_SSQ ~ Age + ear + Class + Gender + own_ha + ha_dispencer +\n                    SSQ1 + ha_use_time + ha_usetime_hours_per_day + own_ha + rand_apparat +\n                    Time_diff_visits, data = data_3, maxdepth = 6,\n                    minbucket = 10, \n                    minsplit = 10)\nrpart.plot(fit_tree, type=2,clip.right.labs = TRUE, branch=1,yesno=2)\n\n#Gender + rand_apparat + Age + Time_diff_visits + SSQ1 + ha_use_time + \n # ha_usetime_hours_per_day + own_ha + ha_dispencer + ear + Class\n\n\n\n#classification tree right\nfit_tree <- ctree(diff_SSQ ~ Gender + rand_apparat + Age + Time_diff_visits + SSQ1 + ha_use_time + \n                    ha_usetime_hours_per_day + own_ha + ha_dispencer + ear + Class,\n                  data = data_3)\nplot(fit_tree,main='Classification based on age and gender right ear')\n\n\n\n#save csv \nwrite.csv(data_3,'SSQDifference_Gender_Age_Time-Diff-Visits_SSQ1_HA-USE-TIME-Hours_OwnHA_HA-dispenser_Ear_AudClass.csv')\n\n",
    "created" : 1552918121632.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1633169559",
    "id" : "B1D3FD1D",
    "lastKnownWriteTime" : 1551109378,
    "last_content_update" : 1551109378,
    "path" : "~/BEAR/bear-analysis/Regression tree/Tree_analysis_script.R",
    "project_path" : "Tree_analysis_script.R",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}