{
    "collab_server" : "",
    "contents" : "---\ntitle: \"R Notebook for Age & Hearing\"\noutput: html_notebook\n---\n\n```{r}\n\nlibrary('dplyr')\n\nsource('setup.R')\n\ntmp <- t3.data.15d %>% merge(t3.data.ssq,by = c('record_id','redcap_event_name')) %>%\n  merge(t3.data.thi, c('record_id','redcap_event_name')) %>% \n  merge(df_fitting_rationale, c('record_id','redcap_event_name')) %>% merge(df_ioi, c('record_id','redcap_event_name'))\n\ntmp <- tmp %>% merge(df_tinnitus, c('record_id')) %>%\nmerge(df_motivation, c('record_id')) %>%\nmerge(df_ha_use, c('record_id')) %>% \nmerge(df_audiogram, c('record_id')) %>%\nmerge(df_CCI, c('record_id'))\n\n```\n\n\n```{r}\n\ndf_ssq.wider$ssq_speech_mean <- rowMeans(df_ssq.wider[,grepl(\"ssq_speech\", colnames(df_ssq.wider))], na.rm = TRUE)\ndf_ssq.wider$ssq_space_mean <- rowMeans(df_ssq.wider[,grepl(\"ssq_space\", colnames(df_ssq.wider))], na.rm = TRUE)\ndf_ssq.wider$ssq_sound_mean <- rowMeans(df_ssq.wider[,grepl(\"ssq_sound\", colnames(df_ssq.wider))], na.rm = TRUE)\n\ndata.lr <- df_ssq.wider %>% merge(tmp, by = c('record_id') )\n\ndata.lr <- data.lr[,-c(134,45:62,122,115)]\n\ndata.lr.gn <- data.lr[data.lr$ha_manufactor.x == 'GN ReSound',]\n\ndata.lr.gn$ssq_mean <-  rowMeans(data.lr.gn[,c(21:23)], na.rm = TRUE)\n\ndata.lr.gn <- data.lr.gn[!is.na(data.lr.gn$own_ha.x),] \n\n\n\n```\n\nLet's try to plot the SSQ benefit:\n\n```{r}\nlibrary('ggplot2')\nlibrary('gridExtra')\n\n\np1 <- data.lr.gn %>% ggplot(aes(x = own_ha.x, y = ssq_speech_mean.x, fill = redcap_event_name)) + \n  geom_boxplot(width = 0.5) + scale_x_discrete(labels = c('New Users','Experienced')) + \n  labs(x = '',y = '',title = 'SSQ Speech') + scale_fill_discrete(name = 'Visit', labels = c('','')) +\n  theme(axis.text = element_text(size = 20),\n        legend.text = element_blank(),\n        axis.title.y = element_text(size=20),\n        legend.title = element_blank(),\n        title = element_text(size = 23),\n        legend.position = 'none') \n    \np2 <- data.lr.gn %>% ggplot(aes(x = own_ha.x, y = ssq_space_mean.x, fill = redcap_event_name)) + \n  geom_boxplot(width = 0.5) + scale_x_discrete(labels = c('New Users','Experienced')) + \n  labs(x = '',y = '',title = 'SSQ Space') + scale_fill_discrete(name = 'Visit', labels = c('','')) +\n  theme(axis.text = element_text(size = 20),\n        legend.text = element_blank(),\n        axis.title.y = element_text(size=20),\n        legend.title = element_blank(),\n        title = element_text(size = 23),\n        legend.position = 'none') \n\np3 <- data.lr.gn %>% ggplot(aes(x = own_ha.x, y = ssq_sound_mean.x, fill = redcap_event_name)) + \n  geom_boxplot(width = 0.5) + scale_x_discrete(labels = c('New Users','Experienced')) + \n  labs(x = '',y = '',title = 'SSQ Sound') + scale_fill_discrete(name = 'Visit', labels = c('1st','2nd')) +\n  theme(axis.text = element_text(size = 20),\n        legend.text = element_text(size = 20),\n        axis.title.y = element_text(size=20),\n        legend.title = element_text(size=20),\n        title = element_text(size = 23),\n        legend.position = 'none')\n  \np4 <- data.lr.gn %>% ggplot(aes(x = own_ha.x, y = ssq_mean, fill = redcap_event_name)) +   \n  geom_boxplot(width = 0.5) + scale_x_discrete(labels = c('New Users','Experienced')) + \n  labs(x = '',y = '',title = 'Mean (Speech, Space, Sound)') + scale_fill_discrete(name = 'Visit', labels = c('1st','2nd')) +\n  theme(axis.text = element_text(size = 20),\n        legend.text = element_text(size = 20),\n        axis.title.y = element_text(size=20),\n        legend.title = element_text(size=20),\n        title = element_text(size = 23))     \n\npng('SSQ benefit.png',width = 1200, height = 900)\n\ngrid.arrange(p1,p2,p3,p4,ncol = 2, nrow = 2)\n\ndev.off()\n\n```\nPlot SSQ dependence on ha use time: \n\n```{r}\ndata.lr.gn.exp <- data.lr.gn[data.lr.gn$own_ha.x == 'Yes',]\ndata.lr.gn.new <- data.lr.gn[data.lr.gn$own_ha.x == 'No',]\n\n#experienced\ndiff_speech<- data.lr.gn.exp$ssq_speech_mean.x[data.lr.gn.exp$redcap_event_name == 'besoeg2_arm_1'] - data.lr.gn.exp$ssq_speech_mean.x[data.lr.gn.exp$redcap_event_name == 'baseline_arm_1']\n\ndiff_space <- data.lr.gn.exp$ssq_space_mean.x[data.lr.gn.exp$redcap_event_name == 'besoeg2_arm_1'] - data.lr.gn.exp$ssq_space_mean.x[data.lr.gn.exp$redcap_event_name == 'baseline_arm_1']\n\ndiff_sound <- data.lr.gn.exp$ssq_sound_mean.x[data.lr.gn.exp$redcap_event_name == 'besoeg2_arm_1'] - data.lr.gn.exp$ssq_sound_mean.x[data.lr.gn.exp$redcap_event_name == 'baseline_arm_1']\n\n\ntime <- data.lr.gn.exp$ha_usetime_hours_per_day[data.lr.gn.exp$redcap_event_name == 'besoeg2_arm_1']\n\nbla.exp <- data.frame(diff_speech,diff_space, diff_sound, time) \n\n\np1 <- bla.exp %>% ggplot(aes(x = time, y = diff_speech)) +\n  geom_point(size = 2, color = 'blue') + geom_smooth(color = 'red',size=2)  + scale_y_continuous(limits = c(-30,50)) +\n  labs(x = 'Time [h]',y = 'SSQ benefit',title = 'Speech (Experienced Users)') +\n  theme(axis.text = element_text(size = 18),\n        legend.text = element_blank(),\n        axis.title.y = element_text(size=18),\n        legend.title = element_blank(),\n        title = element_text(size = 20),\n        legend.position = 'none') \n\np2 <- bla.exp %>% ggplot(aes(x = time, y = diff_space)) +\n  geom_point(size = 2, color = 'blue') + geom_smooth(color = 'red',size=2)  +scale_y_continuous(limits = c(-30,50)) +\n  labs(x = 'Time [h]',y = '',title = 'Space (Experienced Users)') +\n  theme(axis.text = element_text(size = 18),\n        legend.text = element_blank(),\n        axis.title.y = element_text(size=18),\n        legend.title = element_blank(),\n        title = element_text(size = 20),\n        legend.position = 'none') \n\np3 <- bla.exp %>% ggplot(aes(x = time, y = diff_sound)) +\n  geom_point(size = 2, color = 'blue') + geom_smooth(color = 'red',size=2)   + scale_y_continuous(limits = c(-30,50))+\n  labs(x = 'Time [h]',y = '',title = 'Sound (Experienced Users)')  +\n  theme(axis.text = element_text(size = 18),\n        legend.text = element_blank(),\n        axis.title.y = element_text(size=18),\n        legend.title = element_blank(),\n        title = element_text(size = 20),\n        legend.position = 'none') \n\n\npng('Time Exp User.png',width = 1500, height = 700)\n\ngrid.arrange(p1,p2,p3,ncol = 3)\n\ndev.off()\n\n\n#new\n\ndiff_speech<- data.lr.gn.new$ssq_speech_mean.x[data.lr.gn.new$redcap_event_name == 'besoeg2_arm_1'] - data.lr.gn.new$ssq_speech_mean.x[data.lr.gn.new$redcap_event_name == 'baseline_arm_1']\n\ndiff_space <- data.lr.gn.new$ssq_space_mean.x[data.lr.gn.new$redcap_event_name == 'besoeg2_arm_1'] - data.lr.gn.new$ssq_space_mean.x[data.lr.gn.new$redcap_event_name == 'baseline_arm_1']\n\ndiff_sound <- data.lr.gn.new$ssq_sound_mean.x[data.lr.gn.new$redcap_event_name == 'besoeg2_arm_1'] - data.lr.gn.new$ssq_sound_mean.x[data.lr.gn.new$redcap_event_name == 'baseline_arm_1']\n\n\ntime <- data.lr.gn.new$ha_usetime_hours_per_day[data.lr.gn.new$redcap_event_name == 'besoeg2_arm_1']\n\nbla.new <- data.frame(diff_speech,diff_space, diff_sound, time) \n\n\np1 <- bla.new %>% ggplot(aes(x = time, y = diff_speech)) +\n  geom_point(size = 2, color = 'blue') + geom_smooth(color = 'red',size=2)  + scale_y_continuous(limits = c(-30,50)) +\n  labs(x = 'Time [h]',y = 'SSQ benefit',title = 'Speech (New Users)') +\n  theme(axis.text = element_text(size = 18),\n        legend.text = element_blank(),\n        axis.title.y = element_text(size=18),\n        legend.title = element_blank(),\n        title = element_text(size = 20),\n        legend.position = 'none') \n\np2 <- bla.new %>% ggplot(aes(x = time, y = diff_space)) +\n  geom_point(size = 2, color = 'blue') + geom_smooth(color = 'red',size=2)  +scale_y_continuous(limits = c(-30,50)) +\n  labs(x = 'Time [h]',y = '',title = 'Space (New Users)') +\n  theme(axis.text = element_text(size = 18),\n        legend.text = element_blank(),\n        axis.title.y = element_text(size=18),\n        legend.title = element_blank(),\n        title = element_text(size = 20),\n        legend.position = 'none') \n\np3 <- bla.new %>% ggplot(aes(x = time, y = diff_sound)) +\n  geom_point(size = 2, color = 'blue') + geom_smooth(color = 'red',size=2)   + scale_y_continuous(limits = c(-30,50))+\n  labs(x = 'Time [h]',y = '',title = 'Sound (New Users)')  +\n  theme(axis.text = element_text(size = 18),\n        legend.text = element_blank(),\n        axis.title.y = element_text(size=18),\n        legend.title = element_blank(),\n        title = element_text(size = 20),\n        legend.position = 'none') \n\npng('Time New User.png',width = 1500, height = 700)\n\ngrid.arrange(p1,p2,p3,ncol = 3)\n\ndev.off()\n\n```\n\n",
    "created" : 1570535947078.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1719706862",
    "id" : "4E42D347",
    "lastKnownWriteTime" : 1570636559,
    "last_content_update" : 1570636559067,
    "path" : "~/BEAR/MsC code/bear-msc/Age&Hearing/Analysis.Rmd",
    "project_path" : "Analysis.Rmd",
    "properties" : {
        "chunk_output_type" : "inline",
        "tempName" : "Untitled1"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}